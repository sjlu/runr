<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map_canvas { height: 100% }
    </style>
    <script src="data.js"></script>
    <script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCPwtd8OhMHi-yXiEhG-dCWY-siRblQOUo&sensor=true"></script>
    <script type="text/javascript">
      function initialize() {
        var mapOptions = {
          center: new google.maps.LatLng(40.7143528, -74.0059731),
          zoom: 13, // higher is more zoomed in
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("map_canvas"),
            mapOptions);

        var directionsService = new google.maps.DirectionsService();
        var directionsDisplay = new google.maps.DirectionsRenderer();

        directionsDisplay.setMap(map);

        // `thedata` is what you get from the routing api

        // taking the first out of the 10 results I give you
        thedata = thedata[0];

        //  new google.maps.LatLng(37.869085,-122.254775); to make a new lat lon pt

        var lastloc = thedata.locations.pop();

        // shift of the start location
        thedata.locations.shift();

        var query = {
          // start location
          origin: new google.maps.LatLng(40.7143528, -74.0059731),

          // last destination
          destination: new google.maps.LatLng(Number(lastloc.lat), Number(lastloc.lon)),

          travelMode: google.maps.TravelMode.WALKING,
          unitSystem: google.maps.UnitSystem.IMPERIAL,

          waypoints: []
        };

        for (var i = 0; i < thedata.locations.length; i++) {
          query.waypoints.push({
            location: new google.maps.LatLng(
              Number(thedata.locations[i].lat), 
              Number(thedata.locations[i].lon)
            ),
            stopover: true
          });
        }

        //delete query.waypoints;
        console.dir(query);

        directionsService.route(query, function(response, status) {
          console.log(status);
          if (status == google.maps.DirectionsStatus.OK) {
            directionsDisplay.setDirections(response);
          }
        });
      }
    </script>
  </head>
  <body onload="initialize()">
    <div id="map_canvas" style="width:100%; height:100%"></div>
  </body>
</html>
